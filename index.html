<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تسجيل دخول الأدمن - Tech Time</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; background-color:#222831; color:#EEEEEE; }
    .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
    .input { width:100%; padding:10px; border-radius:8px; background:rgba(255,255,255,0.1); color:white; outline:none; margin-bottom:10px; }
    .input:focus { outline: 2px solid #00ADB5; }
    .btn { background:#00ADB5; padding:10px; border-radius:8px; font-weight:bold; transition:0.3s; width:100%; }
    .btn:hover { background:#00939a; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center">

  <div class="glass p-6 rounded-xl w-80 text-center">
    <h2 class="text-2xl font-bold mb-4">تسجيل دخول الأدمن</h2>
    <input id="email" type="email" placeholder="البريد الإلكتروني" class="input">
    <input id="password" type="password" placeholder="كلمة المرور" class="input">
    <button id="loginBtn" class="btn">تسجيل الدخول</button>
    <p id="loginError" class="text-red-500 text-sm mt-2 hidden"></p>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAPRUZs1HHbucnnOdqOr280TjLH86qETnA",
    authDomain: "techtimev3.firebaseapp.com",
    projectId: "techtimev3",
    storageBucket: "techtimev3.appspot.com",
    messagingSenderId: "435597436729",
    appId: "1:435597436729:web:2bd440942a6c0da8fb6ae8",
    measurementId: "G-3984PMGWGH"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const emailInput = document.getElementById("email");
  const passInput = document.getElementById("password");
  const loginBtn = document.getElementById("loginBtn");
  const loginError = document.getElementById("loginError");

  loginBtn.addEventListener("click", async () => {
    const email = emailInput.value.trim();
    const password = passInput.value.trim();

    if(!email || !password){
      loginError.textContent = "يرجى إدخال البريد الإلكتروني وكلمة المرور";
      loginError.classList.remove("hidden");
      return;
    }

    try {
      const userCred = await signInWithEmailAndPassword(auth, email, password);
      const user = userCred.user;

      // تحقق من كولكشن admin
      const adminRef = doc(db, "admin", user.uid);
      const adminSnap = await getDoc(adminRef);

      if (!adminSnap.exists()) {
        alert("❌ ليس لديك صلاحية لدخول لوحة التحكم");
        await signOut(auth);
        window.location.href = "index.html";
      } else {
        // ✅ أدمن حقيقي → روح للوحة التحكم
        window.location.href = "admin.html"; 
      }

    } catch (error) {
      console.error(error);
      loginError.textContent = "بيانات تسجيل الدخول غير صحيحة";
      loginError.classList.remove("hidden");
    }
  });
</script>

</body>
</html>